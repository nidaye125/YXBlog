{"code":"!function(e){function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}var t={};n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var r in e)n.d(o,r,function(n){return e[n]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p=\"\",n(n.s=1)}([function(e,n,t){\"use strict\";function o(e){return i.default.isEmpty(e)?(console.error(\"\".concat(e,\" is undefined, can not inject! \")),console.log(\"\".concat(e,\" is undefined, can not inject! \")),!1):((!e.inject||\"object\"!==(0,c.default)(e.inject))&&(e.inject={}),(!e.inject.cache||\"object\"!==(0,c.default)(e.inject.cache))&&(e.inject.cache={}),e.inject.cache.set=l,e.inject.cache.get=f,void(e.inject.cache.delete=d))}var r=t(2);Object.defineProperty(n,\"__esModule\",{value:!0}),n.injectCache=o,n.initCache=function(e){return new Promise(function(n,t){(0,a.openDB)(\"off-lineDB\",window._dbVersion,window._dbTables).then(function(r){!0===r?(n(),o(e)):t(new Error)}).catch(function(e){t(e)})})};var c=r(t(3)),a=t(4),i=r(t(5)),u=\"set参数格式应是：{key: someKey, value: someValue}或者：[{key: someKey, value: someValue}]\",s=\"delete参数格式应为Array或者String\",l=function(e,n){return new Promise(function(t){if(n||(n=\"business\"),i.default.isEmpty(e))return console.error(u),void t({code:500,message:u});if(Array.isArray(e)&&0<e.length){var o=[];e.forEach(function(e){e.value&&e.key&&(e.value.attrKey=e.key),o.push(e.value)}),(0,a.IDB_saveDatas)(o,n).then(function(){t({code:200,message:\"成功保存\".concat(o.length,\"条数据\")})}).catch(function(e){console.error(e),t({code:500,message:e})})}else{if(!e.key||!e.value)return console.error(u),void t({code:500,message:u});e.value.attrKey=e.key,(0,a.IDB_saveData)(e.value,n).then(function(){t({code:200,message:\"成功保存\".concat(e.key)})}).catch(function(e){console.error(e),t({code:500,message:e})})}})},f=function(e,n){return new Promise(function(t){n||(n=\"business\"),i.default.isEmpty(e)?(0,a.IDB_searchData)({dbTableName:n}).then(function(e){t({code:200,data:e})}).catch(function(e){t({code:500,message:e})}):Array.isArray(e)&&0<e.length?(0,a.IDB_getDatas)({key:e,dbTableName:n}).then(function(e){t({code:200,data:e})}).catch(function(e){t({code:500,message:e})}):\"string\"==typeof e||\"number\"==typeof e?(0,a.IDB_getData)({key:e,dbTableName:n}).then(function(e){t({code:200,data:[e]})}).catch(function(e){t({code:500,message:e})}):t({code:500,message:\"get参数格式不正确\"})})},d=function(e,n){return new Promise(function(t){n||(n=\"business\"),i.default.isEmpty(e)?(console.error(s),t({code:500,message:s})):Array.isArray(e)&&0<e.length?(0,a.IDB_deleteSomeData)({id:e,dbTableName:n}).then(function(n){t(\"删除成功\"===n?{code:200,message:\"成功删除\".concat(e.length,\"条数据\")}:{code:500,message:\"删除数据失败\"})}).catch(function(e){t({code:500,message:e})}):\"string\"==typeof e||\"number\"==typeof e?(0,a.IDB_deleteOneData)({id:e,dbTableName:n}).then(function(n){t(\"删除成功\"===n?{code:200,message:\"成功删除\".concat(e,\"数据\")}:{code:500,message:\"删除数据失败\"})}).catch(function(e){t({code:500,message:e})}):t({code:500,message:s})})}},function(e,n,t){\"use strict\";t.r(n);var o=t(0);t.n(o);console.log({initCache:o.initCache})},function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}}},function(e){function n(t){return e.exports=n=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},n(t)}e.exports=n},function(e,n){\"use strict\";Object.defineProperty(n,\"__esModule\",{value:!0}),n.openDB=function(e,n,o){return new Promise(function(r){var c=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB;if(!c)return console.error(\"你的浏览器不支持IndexedDB!\"),void r(\"连接数据库失败\");if(!n||!o||!o.length)return console.error(\"openDB参数错误！\"),void r(\"连接数据库失败\");var a=c.open(e,n);a.onsuccess=function(e){t=e.target.result,window.__db=t,console.log(\"连接数据库成功\"),t.onclose=function(){console.log(\"数据库意外关闭\")},t.onversionchange=function(){console.log(\"数据库版本变化时触发（发生upgradeneeded事件，或调用indexedDB.deleteDatabase()）\")},r(!0)},a.onerror=function(){console.log(\"连接数据库失败\"),r(\"连接数据库失败\")},a.onblocked=function(){console.log(\"上一次的数据库连接还未关闭\")},a.onupgradeneeded=function(e){t=e.target.result,o.forEach(function(e){t.objectStoreNames.contains(e)||(\"save_data\"==e||\"upLoaded\"==e?t.createObjectStore(e,{keyPath:\"indexedDB_id\",autoIncrement:!0}):t.createObjectStore(e,{keyPath:\"attrKey\"}))})}})},n.IDB_saveData=function(e,n){return new Promise(function(o,r){var c=n||\"save_data\",a=t.transaction(c,\"readwrite\"),i=a.objectStore(c).put(e),u=\"\",s=!1;i.onsuccess=function(){u=this.result,s=!0},i.onerror=function(e){u=e.target.result},a.oncomplete=function(){s?(console.log(\"成功保存id为\"+u+\"的数据\"),o(!0)):(cb.utils.alert(\"IDB_saveData存储操作成功，事务失败！\"),r(u))},a.onerror=function(){console.log(u.error),cb.utils.alert(\"缓存数据失败！\",\"error\"),r(u)}})},n.IDB_saveDatas=function(e,n){return new Promise(function(o,r){e&&e.length||r(new Error(\"数据格式错误！\"));for(var c=n||\"save_data\",a=t.transaction(c,\"readwrite\"),i=a.objectStore(c),u=0,s=0,l=e.length;s<l;s++)i.put(e[s]).onsuccess=function(){u++};a.oncomplete=function(){u==e.length?(console.log(\"成功保存多条数据:\"+e.length+\"条\"),o(!0)):(cb.utils.alert(\"保存多条数据失败！\".concat(e.length-u,\"条保存失败\")),r(new Error(\"保存多条数据失败！\".concat(e.length-u,\"条保存失败\"))))},a.onerror=function(e){console.log(e),cb.utils.alert(\"保存多条数据失败！\",\"error\"),r(e)}})},n.IDB_deleteOneData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n){var o=e.id,r=e.dbTableName;r||(r=\"save_data\");var c=t.transaction(r,\"readwrite\").objectStore(r).delete(o);c.onsuccess=function(){n(\"删除成功\")},c.onerror=function(){n(\"删除失败\")}})},n.IDB_deleteSomeData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n){var o=e.id,r=e.dbTableName;r||(r=\"save_data\");var c=t.transaction(r,\"readwrite\"),a=c.objectStore(r),i=0;if(Array.isArray.call(null,o)&&0<o.length)for(var u=function(e){(f=a.delete(o[e])).onsuccess=function(){i++,console.log(\"删除多条数据时候，id为：\".concat(o[e],\"成功\"))},f.onerror=function(n){console.error(\"删除多条数据时候，id为：\".concat(o[e],\"数据删除时候出错；错误为：\").concat(n))}},s=0,l=o.length;s<l;s++){var f;u(s)}c.oncomplete=function(){i==o.length?n(\"删除成功\"):n(\"删除失败\")},c.onerror=function(e){n(\"删除失败\"),console.error(\"删除多条数据时候tansaction error: \"+e)}})},n.IDB_searchData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.onlyCheck,r=e.dbTableName;return new Promise(function(e,c){var a=r||\"save_data\",i=t.transaction(a,\"readonly\").objectStore(a),u=IDBKeyRange.lowerBound(1),s=i.openCursor(u,\"next\");o=[],s.onsuccess=function(){var t=this.result;if(t){if(n)return o.push(t.value),void e(o);o.push(t.value),t.continue()}else e(o)},s.onerror=function(e){c(e.target.result)}})},n.IDB_getData=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,o){var r=e.key,c=e.dbTableName,a=t.transaction(c,\"readonly\").objectStore(c).get(r);a.onsuccess=function(e){n(e.target.result)},a.onerror=function(e){o(e.target.result)}})},n.IDB_getDatas=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(n,o){var r=e.key,c=e.dbTableName;r&&r.length||o(new Error(\"数据格式错误！\"));for(var a=t.transaction(c,\"readonly\"),i=a.objectStore(c),u=[],s=0,l=r.length;s<l;s++)i.get(r[s]).onsuccess=function(e){u.push(e.target.result)};a.oncomplete=function(){u.length==r.length?n(u):o(new Error(\"\".concat(r.length-u.length,\"条数据读取失败!\")))},a.onerror=function(e){console.log(e),cb.utils.alert(\"读取多条数据失败！\",\"error\"),o(e)}})},n.IDB_tableClear=function(e){return new Promise(function(n){if(e){var o=t.transaction(e,\"readwrite\").objectStore(e).clear();o.onsuccess=function(){n(\"清除\".concat(e,\"表全部数据成功\"))},o.onerror=function(){console.error(\"清除\".concat(e,\"表全部数据失败！\")),n(!1)}}else n(!1)})};var t=\"\",o=[]},function(e){e.exports=lodash}]);","extractedComments":[]}