---
title: 事件循环-浏览器
date: 2019-07-18 08:30:41
tags: 事件循环
---

浏览器的事件循环机制可以理解成js的事件循环机制，本篇博客只是简单地介绍一下整个事件循环的机制，具体的原因之后的会详细的讲

<!--more-->

#  1 操作系统的概念

这里有几个操作系统的概念，异步 并行 并发等介绍一下

 ## 1.1 异步 vs 并行
术语“异步”和“并行”常常被混为一谈，但实际上它们的意义完全不同。记住，

异步是关于现在和将来的时间间隙，

并行是关于能够同时发生的事情。 

区别很大，异步和并行会导致运行结果不一致，但是程度上不一样，异步的这种不确定性是在函数(事 件)顺序级别上，多线程（并行）情况下的不确定性是语句顺序级别(或者说，表达式运算顺序级别)。 换句话说，这异步确定性要高于多线程（并行）情况。 

 ## 1.2 并发
现在让我们来设想一个展示状态更新列表(比如社交网络新闻种子)的网站，其随着用户向下滚动列表而逐渐加载更多内容。要正确地实现这一特性，需要(至少)两个独立的 “进程”同时运行(也就是说，是在同一段时间内，并不需要在同一时刻)。 

>注意
这里的“进程”之所以打上引号，是因为这并不是计算机科学意义上的真正 操作系统级进程。这是虚拟进程，或者任务，表示一个逻辑上相关的运算序 列。 

# 2 事件循环event loop

## 2.1 概述

JavaScript是单线程(只有一个主线程)的语言

Event Loop是JavaScript的执行机制

JavaScript的任务分为同步任务和异步任务。异步任务分为宏任务和微任务

## 2.2 常见的概念：

- 堆和栈。当javascript代码执行的时候会将不同的变量存于内存中的不同位置：堆（heap）和栈（stack）中来加以区分。其中，堆里存放着一些对象。而栈中则存放着一些基础类型变量以及对象的指针。
 
- 执行栈。但是我们这里说的执行栈和上面这个栈的意义却有些不同。当一个脚本第一次被执行的时候，js引擎会解析这段代码，并将其中的**同步代码按照执行顺序加入执行栈中**，然后从头开始执行。如果当前执行的是一个方法，那么js会向执行栈中**添加**这个方法的执行环境，**然后进入**这个执行环境继续执行其中的代码。当这个执行环境中的代码 **执行完毕**并返回结果后，js会**退出这个执行环境**并把这个执行环境销毁，**回到上一个方法的执行环境**。这个过程反复进行，直到执行栈中的代码全部执行完毕。
  
- 同步任务(synchronous)：**指在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务。**

- 异步任务(asynchronous)：指不进入主线程、而进入"任务队列"的任务

- 宏任务(macrotask)：包括setTimeOut 、 setInterval 、setImmediate 、 I/O 、 各种callback、UI渲染等
> 优先级如下：主代码块 > setImmediate >MessageChannel > setTimeOut/setInterval

- 微任务(microtask)：包括process.nextTick 、Promise、MutationObserver 、async(实质上也是promise)
> 优先级如下：process.nextTick > Promise >MutationOberser

- 任务队列(task queue/callback queue)：包括1个microtask队列和1个或多个macrotask队列


## 2.3 事件循环的简单描述

> 主代码块->微任务->宏任务->微任务->宏任务...(主代码块也是一个宏任务)
详细解释如下：

- 1、主代码块入栈
- 2、顺序执行代码块中的*同步任务*，遇到异步任务则交由浏览器内核的其模块处理，处理完后将异步任务的回调函数加入到任务队列中(**一般不同异步任务的回调函数会放入不同的任务队列之中**)
- 3、当函数执行栈为空时，若microtask队列中有任务则先将microtask队列中的所有微任务入栈执行，当函数执行栈为空，再从macrotask队列中取出一个宏任务入栈。
- 4、2~3步骤循环，直到所有任务执行完


## 2.4 事件循环的图片

这张图片应该是最全的图片了

异步任务先去执行micro的任务之后再去找macro任务

![此处输入图片的描述][1]



# 3 demo展示

可以直接参考一篇文章，写的事件循环机制非常的不错。

[事件循环机制demo](https://juejin.im/post/5a6309f76fb9a01cab2858b1?utm_medium=fe&utm_source=weixinqun#heading-5)


[1]: https://raw.githubusercontent.com/XYooo/image/master/el1.png